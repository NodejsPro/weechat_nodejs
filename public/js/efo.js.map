{"version":3,"sources":["controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"efo.js","sourcesContent":["var g_connect_page_id = undefined;\r\nvar g_user_id = undefined;\r\nvar origin_url = '';\r\n\r\nvar g_preview_flg_param = '';\r\nvar g_refresh_log_flg_param = '';\r\nvar g_force_log_param = '';\r\n\r\n//name cookie for session conversation\r\nvar g_cookie_connect_page_id_name = 'wc_connect_page_id';\r\nvar g_cookie_user_id_name = 'wc_user_id';\r\nvar g_maximize_flg_name = 'maximize_flg';\r\n\r\nvar wc_server_url = '';\r\nvar g_get_log_message = false;\r\n\r\n//list type animation show chatbox PC version\r\nvar g_chatbox_show_type_list = {\r\n    'upward'    : '001',\r\n    'leftward'  : '002'\r\n};\r\n//type default animation show chatbox PC version\r\nvar g_chatbox_show_type = '001';\r\n\r\n//list class for close type (minimize type) chatbox\r\nvar g_chatbox_close_class_list = {\r\n    //avatar and title\r\n    '001'  : 'close_type_001',\r\n    //only avatar\r\n    '002'  : 'close_type_002',\r\n    //only title and gradation\r\n    '003'  : 'close_type_003',\r\n    //only title and no gradation\r\n    '004'  : 'close_type_004',\r\n};\r\n\r\n//change title variable\r\nvar original_title = document.title;\r\nvar new_msg_title = 'Bot say...';\r\nvar new_msg_flg = false;\r\nvar g_time_short = 24; //1 day = 24 hours\r\n\r\n//create div container\r\nvar webchat_ctn = document.createElement(\"div\");\r\nwebchat_ctn.setAttribute(\"class\", \"wc-webchat-ctn wc-close\");\r\nwebchat_ctn.setAttribute(\"status\", \"closed\");\r\nif (isMobile()) {\r\n    webchat_ctn.classList.add('wc-mobile');\r\n}\r\n\r\n//create right open chat box\r\nvar right_open_box = document.createElement(\"div\");\r\nright_open_box.setAttribute(\"class\", \"right_open_box\");\r\nvar right_open_label = document.createElement(\"span\");\r\nright_open_label.setAttribute(\"class\", \"right_open_label\");\r\n\r\n//create div webchat box for not scroll in outsite\r\nvar webchat_box = document.createElement(\"div\");\r\nwebchat_box.setAttribute(\"class\", \"wc-webchat-box\");\r\n\r\n//create div container\r\nvar iframe = document.createElement(\"iframe\");\r\niframe.setAttribute(\"class\", \"wc-webchat\");\r\niframe.setAttribute(\"id\", \"wc-webchat\");\r\n\r\n//windown hash origin value\r\nvar window_efo_hash = 'efo';\r\n//if true: enable auto open webchat function\r\nvar first_open_flg = false;\r\n\r\n//get data from iframe to config in local\r\nvar iframe_setting = '';\r\n\r\n\r\nfunction embot_init(url, connect_page_id_param, preview_flg_param, refresh_log_flg_param, force_log_param) {\r\n\t//cookie global name\r\n\tg_connect_page_id = connect_page_id_param;\r\n\r\n    //name cookie for session conversation\r\n    g_preview_flg_param = preview_flg_param;\r\n    g_refresh_log_flg_param = refresh_log_flg_param;\r\n    g_force_log_param = force_log_param;\r\n\r\n    if(g_preview_flg_param != void 0 && g_preview_flg_param && g_refresh_log_flg_param != void 0 && g_refresh_log_flg_param) {\r\n        g_cookie_connect_page_id_name = 'wc2_connect_page_id_' + g_connect_page_id;\r\n        g_cookie_user_id_name = 'wc2_user_id_' + g_connect_page_id;\r\n        g_maximize_flg_name = 'maximize2_flg_' + g_connect_page_id;\r\n\r\n    } else if(g_preview_flg_param != void 0 && g_preview_flg_param) {\r\n        g_cookie_connect_page_id_name = 'wc1_connect_page_id_' + g_connect_page_id;\r\n        g_cookie_user_id_name = 'wc1_user_id_' + g_connect_page_id;\r\n        g_maximize_flg_name = 'maximize1_flg_' + g_connect_page_id;\r\n\t}\r\n\r\n\t//url variable\r\n\torigin_url = url.split('/efo');\r\n\torigin_url = origin_url.shift();\r\n\r\n\twc_server_url = url;\r\n\tif(url.indexOf('?') > 0) {\r\n\t\twc_server_url += '&';\r\n\t} else {\r\n\t\twc_server_url += '?';\r\n\t}\r\n\twc_server_url += 'connect_page_id=' + g_connect_page_id;\r\n    //add param preview_flg if exist\r\n    if(g_preview_flg_param != void 0 && g_preview_flg_param) {\r\n        wc_server_url += '&preview_flg=' + g_preview_flg_param;\r\n    }\r\n    //add param refresh_log_flg if exist\r\n    if(g_refresh_log_flg_param != void 0 && g_refresh_log_flg_param) {\r\n        wc_server_url += '&refresh_log_flg=' + g_refresh_log_flg_param;\r\n    }\r\n    //add param force_log_flg if exist\r\n    if(g_force_log_param != void 0 && g_force_log_param) {\r\n        wc_server_url += '&force_log_flg=' + g_force_log_param;\r\n    }\r\n\r\n    iframe.setAttribute(\"src\", wc_server_url);\r\n\r\n\r\n\tif (window.addEventListener) {\r\n\t\twindow.addEventListener(\"message\", function(event) {\r\n            if(event.data != void 0) {\r\n                if(event.data.chat_box_open_close){\r\n                    //close, open chat box\r\n                    if(event.data.connect_page_id != void 0 && event.data.connect_page_id == g_connect_page_id) {\r\n                        chatBoxOpenClose();\r\n                    } else {\r\n                        //if conversation was ended. Close chatbox when click to header\r\n                        chatBoxOpenClose(false);\r\n                    }\r\n                }\r\n\r\n                if(event.data.connect_page_id != void 0 && event.data.connect_page_id == g_connect_page_id) {\r\n                    //set user id to global variable\r\n                    if(event.data.user_id != void 0) {\r\n                        g_user_id = event.data.user_id;\r\n                    }\r\n\r\n                    if(event.data.iframe_setting != void 0) {\r\n                        //notify for client efo is ready\r\n                        createDispatchEvent('efo_load_ready');\r\n\r\n                        iframe_setting = event.data.iframe_setting;\r\n                        setSetting(iframe_setting);\r\n\r\n                    } else if(event.data.cookie != void 0) {\r\n                        //if browser not allow create cookie of iframe then set cookie to client\r\n                        for(var cookie_name in event.data.cookie) {\r\n                            if(event.data.cookie[cookie_name] != void 0) {\r\n                                setCookie(cookie_name, event.data.cookie[cookie_name], g_time_short);\r\n                            }\r\n                        }\r\n\r\n                    } else if(event.data.change_title != void 0 && event.data.change_title) {\r\n                        setTitle(event.data.change_title);\r\n\r\n                    } else if(event.data.limit_user_chat){\r\n                        webchat_ctn.style.display = 'none';\r\n\r\n                    } else if(event.data.clear_cookie){\r\n                        //clear all cookie\r\n                        clearAllCookie();\r\n\r\n                    } else if(event.data.cv_data != void 0) {\r\n                        console.log(\"preview_flg_param=\" + preview_flg_param);\r\n                        if(!(preview_flg_param != void 0 && preview_flg_param)) {\r\n                            console.log(\"tracking\");\r\n                            var g_cv_type = {\r\n                                'google_analytic': '001',\r\n                                'google_adword': '002',\r\n                                'yahoo_link': '003'\r\n                            };\r\n\r\n                            var event_cv_data = event.data.cv_data;\r\n                            if(!isEmpty(event_cv_data.list) && event_cv_data.list.length) {\r\n                                $(event_cv_data.list).each(function (i, cv_type) {\r\n                                    switch (cv_type) {\r\n                                        case g_cv_type.google_analytic: {\r\n                                            if(!isEmpty(event.data.gtag_data)) {\r\n                                                //google analytics\r\n                                                try {\r\n                                                    if(typeof ga  === 'function') {\r\n                                                        ga('send', 'event', event.data.gtag_data.event_category, event.data.gtag_data.event_action);\r\n                                                    }else{\r\n                                                        window.dataLayer = window.dataLayer || [];\r\n                                                        function gtag(){dataLayer.push(arguments);}\r\n                                                        gtag('event', 'cv_botchan_efo', {\r\n                                                            'event_category': event.data.gtag_data.event_category,\r\n                                                            'event_action': event.data.gtag_data.event_action\r\n                                                        });\r\n                                                    }\r\n                                                }catch (e) {\r\n                                                    console.log(e);\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                            break;\r\n                                        case g_cv_type.google_adword: {\r\n                                            //google adword\r\n                                            console.log(typeof goog_report_conversion);\r\n                                            console.log(typeof gtag_report_conversion);\r\n                                            try{\r\n                                                if(typeof goog_report_conversion  === 'function'){\r\n                                                    goog_report_conversion();\r\n                                                }else if(typeof gtag_report_conversion  === 'function'){\r\n                                                    gtag_report_conversion();\r\n                                                }\r\n                                            } catch (e) {\r\n                                                console.log(e);\r\n                                            }\r\n                                        }\r\n                                            break;\r\n                                        case g_cv_type.yahoo_link: {\r\n                                            //create iframe request to increase CV\r\n                                            if(!isEmpty(event_cv_data['yahoo_url'])) {\r\n                                                createIframe(event_cv_data['yahoo_url']);\r\n                                            }\r\n                                        }\r\n                                            break;\r\n                                    }\r\n\r\n                                });\r\n                            }\r\n                        }\r\n\r\n                    } else if (event.data.efo_add_to_cart_event != void 0) {\r\n                        //send event to client update product\r\n                        var cart_event_data = event.data.efo_add_to_cart_event;\r\n                        if(!isEmpty(cart_event_data.action_name) && !isEmpty(cart_event_data.action_data)) {\r\n                            //dispatch event to check in client\r\n                            createDispatchEvent('efo_add_to_cart_event', {'detail' : cart_event_data});\r\n                        }\r\n\r\n                    } else if (event.data.efo_document_event != void 0) {\r\n                        //send event to client update product\r\n                        var cart_event_data = event.data.efo_document_event;\r\n                        if(!isEmpty(cart_event_data.action_name) && !isEmpty(cart_event_data.action_data)) {\r\n                            //dispatch event to check in client\r\n                            createDispatchEvent('efo_document_event', {'detail' : cart_event_data});\r\n                        }\r\n\r\n                    } else if (event.data.conversation_end != void 0) {\r\n                        createDispatchEvent('efo_conversation_end_event');\r\n\r\n                    }\r\n\r\n                    if(event.data.new_msg_title != void 0 && event.data.new_msg_title) {\r\n                        new_msg_title = event.data.new_msg_title;\r\n                    }\r\n                }\r\n            }\r\n\t\t}, false);\r\n\t}\r\n\r\n    //Send data to iframe\r\n    window.addEventListener('load', function () {\r\n        // init after load page\r\n        if (isMobile()) {\r\n            minimizeWc();\r\n        }\r\n\r\n        setTimeout(function(){\r\n\t\t\tvar post_msg_data = {};\r\n\t\t\tvar user_id = getCookie(g_cookie_user_id_name),\r\n\t\t\t\tconnect_page_id = getCookie(g_cookie_connect_page_id_name);\r\n\r\n\t\t\t//exist cookie iframe in client then that browser not allow create cookie for iframe\r\n            var cookie = {};\r\n            cookie['is_mobile'] = isMobile();\r\n            if(user_id && connect_page_id) {\r\n            \tcookie[g_cookie_user_id_name] = user_id;\r\n            \tcookie[g_cookie_connect_page_id_name] = connect_page_id;\r\n            }\r\n            post_msg_data['cookie'] = cookie;\r\n\t\t\tpostMessageToServer(post_msg_data);\r\n        }, 500);\r\n\r\n\t\t//set origin title when click insite\r\n\t\twindow.onfocus = function () {\r\n\t\t\tif(new_msg_flg) {\r\n\t\t\t\tsetTitle(false);\r\n\t\t\t}\r\n\t\t};\r\n\r\n    }, false);\r\n\r\n\t//check close chat box when click to back browser\r\n\twindow.addEventListener(\"popstate\", function(e){\r\n\t\tif(isMobile()) {\r\n\t\t\tif(window.location.hash != ('#' + window_efo_hash)) {\r\n\t\t\t\tif(webchat_ctn.getAttribute('status') == 'opening') {\r\n\t\t\t\t\tminimizeWc();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//case: open chat box and close chat box -> history back. Browser exist next url with hash efo -> history back\r\n\t\t\t\thistory.back();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\r\n\t//append child to iframe container\r\n\twebchat_box.appendChild(iframe);\r\n\twebchat_ctn.appendChild(webchat_box);\r\n\tdocument.body.appendChild(webchat_ctn);\r\n\r\n    //open close chat box\r\n    right_open_box.addEventListener('click', function () {\r\n        chatBoxOpenClose();\r\n    });\r\n\r\n}\r\n\r\n//check to show, hide chat box\r\nfunction chatBoxOpenClose(create_cookie_flg) {\r\n    if(webchat_ctn.getAttribute('status') == 'opening'){\r\n        //close chat box then history back\r\n        if(isMobile() && window.location.hash == ('#' + window_efo_hash)) {\r\n            history.back();\r\n        }\r\n        minimizeWc(create_cookie_flg);\r\n    }else{\r\n        maximizeWc(create_cookie_flg);\r\n    }\r\n}\r\n\r\nfunction setSetting(iframe_setting) {\r\n    //set setting for iframe\r\n    var iframe_width = iframe_setting.width,\r\n        iframe_height = iframe_setting.height,\r\n        show_onload = iframe_setting.show_onload,\r\n        chat_color = iframe_setting.color,\r\n        chat_color_name = iframe_setting.color_name,\r\n        time_show_onload = iframe_setting.time_show_onload,\r\n        sp_icon_bottom = iframe_setting.sp_icon_bottom,\r\n        sp_icon_right = iframe_setting.sp_icon_right,\r\n        pc_icon_type = iframe_setting.pc_icon_type,\r\n        pc_icon_bottom = iframe_setting.pc_icon_bottom,\r\n        chat_lang = iframe_setting.chat_lang,\r\n        sub_title = iframe_setting.sub_title,\r\n        sub_sub_title = iframe_setting.sub_sub_title,\r\n        close_type_code = iframe_setting.close_type_code;\r\n\r\n    if(iframe_width && iframe_width > 0) {\r\n        webchat_ctn.style.width = iframe_width + 'px';\r\n        webchat_ctn.setAttribute('data-width', iframe_width);\r\n    }\r\n    if(iframe_height && iframe_height > 0) {\r\n        webchat_ctn.style.height = iframe_height + 'px';\r\n        //data-width, data-height to get in minimize case\r\n        webchat_ctn.setAttribute('data-height', iframe_height);\r\n    }\r\n    if (chat_lang) {\r\n        //set language to webchat_ctn\r\n        webchat_ctn.classList.add(chat_lang);\r\n    }\r\n    //set minimize open type\r\n    if(pc_icon_type && pc_icon_type == g_chatbox_show_type_list.leftward) {\r\n        g_chatbox_show_type = g_chatbox_show_type_list.leftward;\r\n    }\r\n\r\n    //add class close type to body\r\n    webchat_ctn.classList.add(g_chatbox_close_class_list[close_type_code]);\r\n    if(chat_color_name) {\r\n        webchat_ctn.classList.add('theme_' + chat_color_name);\r\n    }\r\n\r\n    if(!isMobile()) {\r\n        //PC and minimize box is right: add right_open_box to webchat_ctn and set style\r\n        if(g_chatbox_show_type == g_chatbox_show_type_list.leftward) {\r\n            if(chat_color) {\r\n                right_open_box.style.backgroundColor = chat_color;\r\n                right_open_box.style.border = 'none';\r\n                right_open_box.style.color = '#fff';\r\n                right_open_box.style.display = 'none';\r\n                right_open_box.style.bottom = (pc_icon_bottom - 40) + 'px';\r\n            }\r\n            right_open_label.innerHTML = sub_sub_title;\r\n            right_open_box.appendChild(right_open_label);\r\n            //add to top in webchat box\r\n            webchat_ctn.insertBefore(right_open_box, webchat_ctn.firstChild);\r\n            webchat_ctn.classList.add('leftward');\r\n            webchat_ctn.style.right = '-' + (iframe_width) + 'px';\r\n        } else {\r\n            webchat_ctn.classList.add('upward');\r\n        }\r\n\r\n        //g_maximize_flg_name is NULL and is show_onload then waiting time to show and create cookie g_maximize_flg_name = 1\r\n        var maximize_flg = getCookie(g_maximize_flg_name);\r\n        if(maximize_flg == 1){\r\n            chatBoxOpenClose();\r\n        } else if(maximize_flg == '0') {\r\n            minimizeWc();\r\n        } else {\r\n            if(g_preview_flg_param == void 0 || !g_preview_flg_param) {\r\n                minimizeWc();\r\n\r\n            } else if(show_onload && show_onload == 1) {\r\n                //not exist g_maximize_flg_name cookie\r\n                minimizeWc();\r\n                setTimeout(function () {\r\n                    //check exist g_maximize_flg_name. Because user open and close webchat before setTimeout then do not action\r\n                    if(!first_open_flg) {\r\n                        maximizeWc();\r\n                    }\r\n                }, time_show_onload * 1000);\r\n            } else {\r\n                minimizeWc();\r\n            }\r\n        }\r\n        setTimeout(function () {\r\n            iframe.style.display = 'block';\r\n            right_open_box.style.display = 'block';\r\n        }, 1000);\r\n\r\n    } else {\r\n        //set bottom, right for webchat mobile\r\n        if(sp_icon_bottom && sp_icon_bottom > 0) {\r\n            webchat_ctn.style.bottom = sp_icon_bottom + 'px';\r\n        }\r\n        if(sp_icon_right && sp_icon_right > 0) {\r\n            webchat_ctn.style.right = sp_icon_right + 'px';\r\n        }\r\n    }\r\n}\r\n\r\n// cookie handle\r\nfunction setCookie(cname, cvalue, hours) {\r\n    var d = new Date();\r\n    d.setTime(d.getTime() + (hours * 60 * 60 * 1000));\r\n    var expires = \"expires=\" + d.toGMTString();\r\n    document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\r\n}\r\n\r\n//get cookie, return \"\" if is not exist\r\nfunction getCookie(cname) {\r\n    var name = cname + \"=\";\r\n    var decodedCookie = decodeURIComponent(document.cookie);\r\n    var ca = decodedCookie.split(';');\r\n    for (var i = 0; i < ca.length; i++) {\r\n        var c = ca[i];\r\n        while (c.charAt(0) == ' ') {\r\n            c = c.substring(1);\r\n        }\r\n        if (c.indexOf(name) == 0) {\r\n            return c.substring(name.length, c.length);\r\n        }\r\n    }\r\n    return \"\";\r\n}\r\n\r\n//clear cookie existing in client\r\nfunction clearAllCookie() {\r\n    setCookie(g_cookie_user_id_name, '', 0);\r\n    setCookie(g_cookie_connect_page_id_name, '', 0);\r\n    setCookie(g_maximize_flg_name, '', 0);\r\n\r\n    //dispatch event to check in client\r\n    createDispatchEvent('efo_clear_event');\r\n}\r\n\r\n// iframe action\r\nfunction minimizeWc(create_cookie_flg) {\r\n    if(webchat_ctn.getAttribute('status') == 'opening') {\r\n        //send status to server\r\n        postMessageToServer({\r\n            'chatbox_show_status': 0\r\n        });\r\n\r\n        if (isMobile()) {\r\n            //remove class to unlock client page\r\n            document.documentElement.classList.remove('efo-lock-screen');\r\n\r\n        } else {\r\n            setTimeout(function () {\r\n                right_open_box.classList.remove('hidden');\r\n            }, 500);\r\n        }\r\n        webchat_ctn.classList.remove('wc-open');\r\n        webchat_ctn.classList.add('wc-close');\r\n        webchat_ctn.setAttribute(\"status\", \"closed\");\r\n\r\n        //PC and minimize box is right: set bottom follow data-width or data-height of webchat_ctn\r\n        if (!isMobile()) {\r\n            if (g_chatbox_show_type == g_chatbox_show_type_list.leftward) {\r\n                var ifm_width_attr = webchat_ctn.getAttribute('data-width');\r\n                webchat_ctn.style.right = '-' + ifm_width_attr + 'px';\r\n            }\r\n        }\r\n\r\n        if (create_cookie_flg == void 0 || create_cookie_flg) {\r\n            setCookie(g_maximize_flg_name, 0, g_time_short);\r\n        }\r\n    }\r\n}\r\n\r\nfunction maximizeWc(create_cookie_flg) {\r\n    if(webchat_ctn.getAttribute('status') == 'closed') {\r\n        //send status to server\r\n        postMessageToServer({\r\n            'chatbox_show_status': 1\r\n        });\r\n\r\n        if (!g_get_log_message) {\r\n            postMessageToServer({\r\n                'maximize_flg': 1\r\n            });\r\n            g_get_log_message = true;\r\n        }\r\n        if (isMobile()) {\r\n            //set hash is efo to check close chat box when click to back browser\r\n            history.pushState(\"efo\", null, \"#\" + window_efo_hash);\r\n\r\n            //add class to lock client page. Delay with animation open chatbox\r\n            setTimeout(function () {\r\n                document.documentElement.classList.add('efo-lock-screen');\r\n            }, 500);\r\n        } else {\r\n            right_open_box.classList.add('hidden');\r\n        }\r\n\r\n        webchat_ctn.classList.remove('wc-close');\r\n        webchat_ctn.classList.add('wc-open');\r\n        webchat_ctn.setAttribute(\"status\", \"opening\");\r\n\r\n        if (create_cookie_flg == void 0 || create_cookie_flg) {\r\n            setCookie(g_maximize_flg_name, 1, g_time_short);\r\n        }\r\n\r\n        first_open_flg = true;\r\n    }\r\n}\r\n\r\nfunction getParam(name, params) {\r\n    var match = RegExp('[?&]' + name + '=([^&]*)').exec(params);\r\n    return match && decodeURIComponent(match[1].replace(/\\+/g, ' '));\r\n}\r\n\r\nfunction isMobile() {\r\n    // return true;\r\n    var check = false;\r\n    (function (a) {\r\n        if (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0, 4))) check = true;\r\n    })(navigator.userAgent || navigator.vendor || window.opera);\r\n    return check;\r\n}\r\n\r\n//check safari browser\r\nfunction isSafari() {\r\n    var is_safari = (navigator.userAgent.search(\"Safari\") >= 0 && navigator.userAgent.search(\"Chrome\") < 0);\r\n    return is_safari;\r\n}\r\n\r\n//send postmessage event to iframe\r\nfunction postMessageToServer(data) {\r\n    //send data to server\r\n    data['connect_page_id'] = g_connect_page_id;\r\n    data['user_id'] = g_user_id;\r\n\r\n    // console.log('client send msg: ', data);\r\n    var wc_irame = document.getElementById(\"wc-webchat\").contentWindow;\r\n    wc_irame.postMessage(data, origin_url);\r\n}\r\n\r\n//chage title when have new message\r\nfunction setTitle(is_new_msg) {\r\n    if(is_new_msg != void 0) {\r\n        new_msg_flg = is_new_msg;\r\n    }\r\n    if(new_msg_flg && document.hasFocus()) {\r\n        new_msg_flg = false;\r\n    }\r\n\r\n    if(new_msg_flg) {\r\n        document.title = (document.title == original_title) ? new_msg_title : original_title;\r\n        setTimeout(function(){\r\n            setTitle();\r\n        }, 3000);\r\n    } else {\r\n        if(document.title != original_title) {\r\n            document.title = original_title;\r\n        }\r\n    }\r\n}\r\n\r\nfunction isEmpty (value, trim) {\r\n    return value === void 0 || value === null || value.length === 0 || (trim && $.trim(value) === '');\r\n}\r\n\r\n//create dispatch event to listen in client\r\nfunction createDispatchEvent(event_name, event_data) {\r\n    if(event_data == void 0) {\r\n        event_data = {};\r\n    }\r\n    var dispatch_event = new CustomEvent(event_name, event_data);\r\n    document.dispatchEvent(dispatch_event);\r\n}\r\n\r\n//create iframe in after body element\r\nfunction createIframe(url) {\r\n    if(!isEmpty(url)) {\r\n        //create div container\r\n        var iframe_elm = document.createElement(\"iframe\");\r\n        iframe_elm.setAttribute(\"src\", url);\r\n        iframe_elm.style.display = 'none';\r\n        iframe_elm.style.width = '0';\r\n        iframe_elm.style.height = '0';\r\n\r\n        document.body.appendChild(iframe_elm);\r\n    }\r\n}\r\n\r\n/*create element in client site for call request open, close chatbox*/\r\n/*function createImgElement (url) {\r\n    var elm = document.createElement(\"img\");\r\n    elm.width = 1;\r\n    elm.height = 1;\r\n    elm.src = url;\r\n    console.log(url);\r\n    return elm\r\n}\r\n\r\nfunction createUrlParam (data){\r\n    var b = [];\r\n    for (var i in data) {\r\n        if(data[i]){\r\n            b.push(i + \"=\" + encodeUrl(data[i]));\r\n        }\r\n    }\r\n    return b.join(\"&\")\r\n}\r\n\r\nfunction encodeUrl (url) {\r\n    if (encodeURIComponent instanceof Function)return encodeURIComponent(url);\r\n    return url\r\n}\r\n\r\nfunction decodeUrl (url) {\r\n    if (decodeURIComponent instanceof Function)return decodeURIComponent(url);\r\n    return url\r\n}*/\r\n\r\n/*\r\n* Execute action by action name\r\n* Ex: btag('event', 'action_name', {'category': 'category name', 'value': '1'});\r\n* */\r\nfunction btag (event, action_name, data) {\r\n    //change open, close chatbox\r\n    if(action_name == 'open') {\r\n        maximizeWc();\r\n    } else if(action_name == 'close') {\r\n        minimizeWc();\r\n    } else if(action_name == 'open_close')  {\r\n        chatBoxOpenClose();\r\n\r\n    }\r\n\r\n    if(event == 'cart' || event == 'doc') {\r\n        if(['add','update','remove'].indexOf(action_name) != -1) {\r\n            var post_msg_data = {\r\n                'cart_action' : {\r\n                    'action_name' : action_name,\r\n                    'action_data' : data\r\n                }\r\n            };\r\n            postMessageToServer(post_msg_data);\r\n        }\r\n\r\n    }\r\n\r\n    /*if(isEmpty(data)) {\r\n        data = [];\r\n    }\r\n    if(typeof data == 'object') {\r\n        data = JSON.stringify(data);\r\n    }\r\n\r\n    var img_elm = createImgElement(origin_url + \"/botchanevent?\" + event + \"=\" + event + \"&\" + createUrlParam(params));\r\n    // src=\"origin_url?event=event&action_name=open_close&data=...\r\n    img_elm.onload = img_elm.onerror = function () {\r\n        img_elm.onload = null;\r\n        img_elm.onerror = function() {\r\n            console.log('Create img element error!');\r\n        };\r\n\r\n        //add to before first script element\r\n        var first_script = document.getElementsByTagName('script')[0];\r\n        first_script.parentNode.insertBefore(img_elm, first_script);\r\n    };*/\r\n}\r\n\r\n\r\n/*btag('cart', 'add', {\r\n    id: 'care_11',\r\n    name: 'product 1 sản phẩm dưỡng da tự nhiên 100% tinh dầu abc',\r\n    sub_name: 'mô tả product 1 sản phẩm dưỡng da tự nhiên 100% tinh dầu abc',\r\n    url: 'https://momentjs.com/docs/#/parsing/',\r\n    image: 'https://botchancms.blob.core.windows.net/tungnk/uploads/bot_picture/782b2ec6a54f5e3632ae.jpg',\r\n    category: 'book,love',\r\n    amount: 4,\r\n    price: '100.2',\r\n    currency: 'VND'\r\n});\r\nbtag('cart', 'remove', {'id': 'care_20'});\r\nbtag('cart', 'update', {\r\n    id: 'care_7',\r\n    name: 'product 1 sản phẩm dưỡng da tự nhiên 100% tinh dầu abc',\r\n    amount: 4,\r\n    price: '100.2',\r\n    currency: 'VND'\r\n});\r\n\r\nbtag('doc', 'add', {\r\n    id: 'care_11',\r\n    name: 'product 1 sản phẩm dưỡng da tự nhiên 100% tinh dầu abc',\r\n    sub_name: 'mô tả product 1 sản phẩm dưỡng da tự nhiên 100% tinh dầu abc',\r\n    url: 'https://momentjs.com/docs/#/parsing/',\r\n    image: 'https://botchancms.blob.core.windows.net/tungnk/uploads/bot_picture/782b2ec6a54f5e3632ae.jpg',\r\n    category: 'book,love',\r\n});\r\nbtag('doc', 'remove', {'id': 'care_20'});\r\nbtag('doc', 'update', {\r\n    name: 'product 1 sản phẩm dưỡng da tự nhiên 100% tinh dầu abc',\r\n    sub_name: 'mô tả product 1 sản phẩm dưỡng da tự nhiên 100% tinh dầu abc',\r\n    url: 'https://momentjs.com/docs/#/parsing/',\r\n    image: 'https://botchancms.blob.core.windows.net/tungnk/uploads/bot_picture/782b2ec6a54f5e3632ae.jpg',\r\n});*/\r\n"]}